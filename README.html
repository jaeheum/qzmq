<p>Title: README</p>

<p>Date: 20150511</p>

<p><A name="toc1-6" title="qzmq" /></p>

<h1>qzmq</h1>

<p>Qzmq provides <a href="http://kx.com">Q</a> bindings for <a href="http://czmq.zeromq.org">CZMQ</a>,
the high-level C binding for <a href="http://www.zeromq.org">ØMQ</a>.</p>

<p>Version 3.0.1 of qzmq corresponding to the same version of CZMQ.
Currently qzmq offers a subset of CZMQ APIs.
See the CZMQ Coverage below.</p>

<p>Qzmq is written and maintained by Jay Han (<a href="m&#97;&#105;&#108;&#x74;&#x6F;:&#106;&#x61;&#x79;&#x2E;&#104;&#x61;&#110;&#64;g&#109;&#x61;&#x69;l&#x2E;&#99;&#x6F;&#x6D;">&#106;&#x61;&#x79;&#x2E;&#104;&#x61;&#110;&#64;g&#109;&#x61;&#x69;l&#x2E;&#99;&#x6F;&#x6D;</a>)</p>

<p>Qzmq is hosted at <a href="https://github.com/jaeheum/qzmq">github</a> and
it uses the <a href="https://github.com/jaeheum/qzmq/issues">issue tracker</a> for all issues and comments.</p>

<p><A name="toc2-21" title="Contents" /></p>

<h2>Contents</h2>

<p>&emsp;<a href="#toc2-26">Features of qzmq</a>
&emsp;<a href="#toc2-36">CZMQ Coverage</a>
&emsp;<a href="#toc2-126">License</a>
&emsp;<a href="#toc2-135">Files of qzmq</a>
&emsp;<a href="#toc2-148">Building qzmq</a>
&emsp;<a href="#toc2-173">Issues</a>
&emsp;<a href="#toc2-177"></a></p>

<p><A name="toc2-26" title="Features of qzmq" /></p>

<h2>Features of qzmq</h2>

<p>Qzmq lets Q users write</p>

<ul>
<li>concurrent code using multi-threads,</li>
<li>distributed systems connecting with systems
<ul>
<li>written in other languages,</li>
<li>written with many software patterns,
using <a href="http://czmq.zeromq.org">CZMQ</a> and  <a href="http://www.zeromq.org">ØMQ</a> developed by the <a href="http://www.zeromq.org">ØMQ</a> community.</li>
</ul></li>
</ul>

<p><A name="toc2-36" title="CZMQ Coverage" /></p>

<h2>CZMQ Coverage</h2>

<p>Qzmq covers a subset of <a href="http://api.zeromq.org/czmq3-0:czmq">CZMQ APIs</a>.
Some czmq APIs seem redundant viz-a-viz q:
zuuid or UUID support, zlist or generic container, etc.</p>

<p><a href="http://api.zeromq.org/CZMQ3-0:zsock">zsock(3) - working with ZeroMQ sockets (high-level)</a></p>

<pre><code>zsock.new[type] //  Return a new socket with a type (zmq`XXX).
zsock.destroy[socket] //  Destroy a socket returned from zsock.new[type].
zsock.bind[socket; `endpoint] //  Bind a socket to an endpoint.
zsock.connect[socket; `endpoint] //  Connect a socket to an endpoint.
zsock.typestr[socket] //  Returns socket type name as a symbol.
</code></pre>

<p><a href="http://api.zeromq.org/CZMQ3-0:zstr">zstr(3) - sending and receiving strings</a></p>

<pre><code>// DO NOT USE with byte vectors or serialized objects.
zstr.recv[socket] //  Receive a symbol from a socket.
zstr.send[socket; `symbol] //  Sends `symbol to a socket.
</code></pre>

<p><a href="http://api.zeromq.org/CZMQ3-0:zmsg">zmsg(3) - working with multipart messages</a></p>

<pre><code>zmsg.new[] //  Create a new empty message object
zmsg.destroy[] //  Destroy a message object and all frames it contains
zmsg.recv[socket] //  Receive a zmsg from socket.
zmsg.send[message; socket] //  Send message to destination socket, and destroy
                           //  the message after sending it successfully. 
zmsg.size[message] //  Return size of message, i.e. number of frames (0 or more).
zmsg.contentsize[message] //  Return the size of the content in a message.
zmsg.prepend[message; frame] //  Push frame to the front of the message, i.e. before all other frames.
zmsg.append[message; frame] //  Add frame to the end of the message, i.e. after all other frames.
zmsg.pop[message] //  Remove first frame from message, if any. Returns frame, or 'empty.
zmsg.first[message] //  Set cursor to first frame in message. Returns frame, or 'empty
zmsg.next[message] //  Return the next frame, or 'empty.
zmsg.last[message] //  Return the last frame, or 'empty.
zmsg.save[message; `:file] //  Save message to an open file, return 0 if OK, else -1.
zmsg.load[message; `:file] //  Load/append an open file into message.
zmsg.dup[message] // Create copy of message, as new message object.
zmsg.print[message] // Send message to STDOUT.
zmsg.is[message] //  Probe the supplied object, and report if it looks like a zmsg_t.
</code></pre>

<p><a href="http://api.zeromq.org/CZMQ3-0:zframe">zframe(3) - working with single message frames</a></p>

<pre><code>zframe.new[data] //  Create a new frame with  data byte vector.
zframe.empty[] //  Create an empty (zero-sized) frame.
zframe.destroy[frame] // Destroy a frame.
zframe.recv[socket] // Receive frame from socket, or nothing.
zframe.send[frame; socket; flags] // Send a frame to a socket, destroy frame after sending.
                                  // Return -1 on error, 0 on success.
zframe.dup[frame] //  Create a new frame that duplicates an existing frame.
zframe.strdup[frame] //  Return frame data as a new symbol.
zframe.streq[frame; `symbol] //  Return 1b if frame body is equal to `symbol
zframe.more[frame] //  Return frame MORE indicator (1 or 0).
zframe.size[frame] //  Return number of bytes in frame data.
zframe.eq[frame1; frame2] // Return 1b if two frames have identical size and data
zframe.reset[frame; data] //  Set new contents for frame with data.
zframe.print[frame; `prefix] //  Send message to STDOUT with `prefix (may be `)
zframe.is[frame] //  Probe the supplied object, and report if it looks like a zframe_t.
</code></pre>

<p><a href="http://api.zeromq.org/CZMQ3-0:zctx">zctx(3) - working with ZeroMQ contexts</a>
    zctx.new[]
    zctx.destroy[ctx]</p>

<p><a href="http://api.zeromq.org/CZMQ3-0:zthread">zthread(3) - working with system threads</a></p>

<pre><code>zthread.new[thread_fn; args]
//  Create a detached thread. A detached thread operates autonomously
//  and is used to simulate a separate process. It gets no ctx, and no
//  pipe.

zthread.fork[ctx; thread_fn]
//  Create an attached thread. An attached thread gets a ctx and a PAIR
//  pipe back to its parent. It must monitor its pipe, and exit if the
//  pipe becomes unreadable. Do not destroy the ctx, the thread does this
//  automatically when it ends.
//  Pass arguments to thread_fn by means of sockets.
</code></pre>

<p>http://thread.gmane.org/gmane.network.zeromq.devel/22647/focus=22651</p>

<blockquote>
  <p>The difference is for the CZMQ infrastructure; the first creates an
"attached thread" (sharing the same context and with a pipe back to
the parent), while the second creates a "detached thread" (shares
nothing, so acts more like a separate process, and cannot talk over
inproc to the parent).</p>
</blockquote>

<p>http://article.gmane.org/gmane.network.zeromq.devel/19147/match=zthread_fork</p>

<blockquote>
  <p>Parent thread creates two sockets, binds one, connects the other,
creates a thread, and passes it one end of the pipe. The child thread
can then talk to the parent over the pipe. We use PAIR sockets for
that.</p>
</blockquote>

<p><A name="toc2-126" title="License" /></p>

<h2>License</h2>

<pre><code>// Copyright (c) 2012, 2015 Jaeheum Han &lt;jay.han@gmail.com&gt;
// This file is part of qzmq.
// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.
</code></pre>

<p><A name="toc2-135" title="Files of qzmq" /></p>

<h2>Files of qzmq</h2>

<ul>
<li>README.html -- from README.md</li>
<li>README.md -- README.txt in Markdown syntax thanks to <a href="https://github.com/imatix/gitdown">Gitdown</a>.</li>
<li>README.txt -- this file.</li>
<li>kx/* -- <code>k.h</code> and <code>c.o</code> from kx.com for building qzmq. (see http://code.kx.com/wiki/TermsAndConditions)</li>
<li>qzmq.c -- C bindings to be linked with CZMQ (with ØMQ) and Q (<code>k.h</code> and <code>c.o</code>).</li>
<li>qzmq.q -- q code used to load the bindings.</li>
<li>qzmq.so -- dynamic library to be loaded into q by <code>qzmq.q</code>.</li>
<li>qzmq_test.q -- test code translated to q from CZMQ's self-test code.</li>
<li>zthread_test.q -- zthread example usage.</li>
</ul>

<p><A name="toc2-148" title="Building qzmq" /></p>

<h2>Building qzmq</h2>

<p>Prerequisites: kdb+ 3.0 or later, <a href="http://www.zeromq.org">ØMQ</a> 4, <a href="http://czmq.zeromq.org">CZMQ</a> 3.
Consult your local sysadmin for installation prerequisites.</p>

<p>Current version 3.0.1 of qzmq has been built with 32-bit kdb+ on Ubuntu 14.04.
Instructions for builidng qzmq assumes kdb+ is instaled under <code>$HOME/q/</code> directory.</p>

<pre><code># for Debian, Ubuntu, ... (kdb+ v3.0 "l32") with ZeroMQ &amp; CZMQ in /usr/local/lib
gcc -DKXVER=3 -m32 -shared -fPIC qzmq.c -o $HOME/q/l32/qzmq.so \
    -Wall -Wextra  -Wl,-rpath -Wl,/usr/local/lib \
    -I./kx/kdb+3.0 -I/usr/local/include/ \
    -L./kx/kdb+3.0/l32 -L/usr/local/lib -lzmq -lczmq
cp qzmq.q assert.q $HOME/q/
</code></pre>

<p>For 64-bit kdb+, drop <code>-m32</code> gcc flag and
replace <code>l32</code> architecture path to appropriate one like <code>l64</code>.</p>

<p><code>qzmq_test.q</code> contains qzmq translation of czmq's self-tests. It can be used as examples of each API.</p>

<p>ZeroMQ <a href="http://zguide.zeromq.org">Guide</a> has examples in many languages.
Translation of these examples to q is <a href="https://github.com/imatix/zguide/tree/master/examples/Q">under way</a>
(pulled from <a href="https://github.com/jaeheum/zguide/tree/master/examples/Q">here</a>).
See <a href="https://github.com/jaeheum/qzmq/issues/5">Issue #5</a>.</p>

<p><A name="toc2-173" title="Issues" /></p>

<h2>Issues</h2>

<p>See the <a href="https://github.com/jaeheum/qzmq/issues">issue tracker</a>.
<A name="toc2-177" title="" /></p>

<hr />

<p><code>README.txt</code> is written in <a href="https://github.com/imatix/gitdown">Gitdown</a>.</p>

<pre><code>    gitdown README.txt &amp;&amp; markdown README.md &gt; README.html
</code></pre>
